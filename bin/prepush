#!/usr/bin/env ruby

require "pre_push"
require "prepush_validator"
require "sln_finder"
require "fileutils"


runner = ARGV[0] || 'nunit262'

if PrePush::Validator.validate(runner)
	bin = File.dirname(__FILE__)
	FileUtils.cp("#{bin}/template/pre-push", ".git/hooks")

	pre_push_hook = ".git/hooks/pre-push"
	file_text = File.read(pre_push_hook)
	sln_path = PrePush::SlnFinder.find || "path/to/your.sln"
	content = file_text.gsub(/\{runner\}/, "\"#{runner}\"").gsub(/\{sln_path\}/, "\"#{sln_path}\"")
	File.open(pre_push_hook, "w") {|file| file.puts content}
	puts "the pre-push hook has been dropped into your hooks dir; please modify it to build your assembly & run your tests."
end