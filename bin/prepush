#!/usr/bin/env ruby

require "pre_push"
require "fileutils"
#puts ARGV[0]

puts "Couldn't find a git repository" if !Dir.exists?('.git')
puts "Couldn't find the git hooks dir" if !Dir.exists?('.git/hooks')
dest = File.dirname(__FILE__)
FileUtils.cp("#{dest}/pre-push", ".git/hooks")

# validate ARGV[0] as runner

runner = ARGV[0] || 'nunit262'
pre_push_hook = ".git/hooks/pre-push"
file_text = File.read(pre_push_hook)
content = file_text.gsub(/\{runner\}/, "\"#{runner}\"")
File.open(pre_push_hook, "w") {|file| file.puts content}